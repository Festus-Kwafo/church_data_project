{% extends '../../dist/templates/dashboard/base.html' %}
{% block page_title %}CLC Data{% endblock %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 mb-4">
            <div class="text-center mb-4">
                <img src={%static 'images/logo_2022.png' %} alt="Logo" height="52">
                <h3 class="text-center mb-4">Attendance Record Form</h3>
            </div>
                {%if messages%}
                {% for message in messages  %}
                <div class="alert alert-{{message.tags}} alert-dismissible fade show" role="alert"> <i class="bi bi-exclamation-triangle me-1"></i> {{message}} <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>
                {% endfor %}
                {%endif%}

            <form method="post" action="">
            {% csrf_token %}
<input type="hidden" name="confirm" id="confirm" value="0">
            <div class="form-floating mb-3">
                {%  render_field form.adults type="number" class="form-control" id="adults"%}
                <label for="adults">Adults</label>
            </div>
            <div class="form-floating mb-3">
                {%  render_field form.children type="number" class="form-control" id="children"%}
                <label for="children" class="form-label">Children</label>
            </div>
                <div class="form-floating mb-3">
                    {%  render_field form.males type="number" class="form-control" id="males"%}
                    <label for="males" class="form-label">Males</label>
                </div>
                <div class="form-floating mb-3">
                    {%  render_field form.females type="number" class="form-control" id="females"%}
                    <label for="females">Females</label>
                </div>

                <div class="form-floating mb-3">
                    {%  render_field form.leaders type="number" class="form-control" id="leaders"%}
                    <label for="leaders">Leaders</label>
                </div>
                <div class="form-floating mb-3">
                    {%  render_field form.first_timers type="number" class="form-control" id="first-timers"%}
                    <label for="first-timers" class="form-label">First Timers</label>
                </div>
                <div class="form-floating mb-3">
                    {%  render_field form.consistency type="number" class="form-control" id="consistency"%}
                    <label for="consistency" class="form-label">Consistency from Previous Week</label>
                </div>
                <div class="form-floating mb-3">
                    {%  render_field form.offering type="currency" class="form-control" id="offering"%}
                    <label for="offering" class="form-label">Offering</label>
                </div>
                <div class="form-floating mb-3">
                    {%  render_field form.tithe type="currency" class="form-control" id="adults"%}
                    <label for="tithe" class="form-label">Tithe</label>
                </div>
                <div class="form-floating mb-3">
                    {%  render_field form.date class="form-control" type="date" id="date"%}
                    <label for="date">Date</label>
                </div>
                <p class="btn btn-primary text-white btn-block float-end" data-bs-toggle="modal" data-bs-target="#verticalycentered" onclick="submitForm()">Submit</p> <button type="reset" class="btn btn-danger me-2 text-white float-end">Reset</button>
                {% include '../../templates/includes/modal.html' %}
            </form>
        </div>
        <script>
            function submitForm() {

        var males = document.getElementById("males").value;
        var adults = document.getElementById("adults").value;
        var females = document.getElementById("females").value;
        var leaders = document.getElementById("leaders").value;
        var children = document.getElementById("children").value;
        var first_timers = document.getElementById("first-timers").value;
        var consistency = document.getElementById("consistency").value;
        var modalBody = document.querySelector("#verticalycentered .modal-body");
        var totalAttendance = parseInt(adults)  + parseInt(children)  
        modalBody.innerHTML = "<p>Adults: " + adults+"</p>" + "<p>Males: " + males+"</p>" + "<p>Females: " + females+"</p>"+"<p>Leaders: " + leaders+"</p>"+"<p>Children: " + children+"</p>"+"<p>First Timers: " + first_timers+"</p>"+"<p>Consistency: " + consistency+"</p>"+ "<strong>Total Attendance: " + totalAttendance+"</p>";
        // submit the form here
            }
            function confirmValues(){
                var inputField = document.getElementById("confirm");
                inputField.value = "1";
            }
            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth() + 1; //January is 0!
            var yyyy = today.getFullYear();

            if (dd < 10) {
               dd = '0' + dd;
            }

            if (mm < 10) {
               mm = '0' + mm;
            }

            today = yyyy + '-' + mm + '-' + dd;
            document.getElementById("date").setAttribute("max", today);
            var currencyInput = document.querySelectorAll( 'input[type="currency"]' );

    for ( var i = 0; i < currencyInput.length; i++ ) {

        var currency = 'GHS'
        onBlur( {
            target: currencyInput[ i ]
        } )

        currencyInput[ i ].addEventListener( 'focus', onFocus )
        currencyInput[ i ].addEventListener( 'blur', onBlur )

        function localStringToNumber( s ) {
            return Number( String( s ).replace( /[^0-9.-]+/g, "" ) )
        }

        function onFocus( e ) {
            var value = e.target.value;
            e.target.value = value ? localStringToNumber( value ) : ''
        }

        function onBlur( e ) {
            var value = e.target.value

            var options = {
                maximumFractionDigits: 2,
                currency: currency,
                style: "currency",
                currencyDisplay: "symbol"
            }

            e.target.value = ( value || value == 0 ) ?
                localStringToNumber( value ).toLocaleString( undefined, options ) :
                ''
        }
    }
        </script>

    </div>
</div>
{%endblock%}